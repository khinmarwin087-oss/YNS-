<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MYIN THAR | PREMIUM POS SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --apple-white: #F5F5F7;
            --apple-dark: #1D1D1F;
            --premium-orange: #FF6B00;
            --glass: rgba(255, 255, 255, 0.85);
            --shadow: 0 12px 40px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--apple-white); color: var(--apple-dark); overflow-x: hidden; }

        .hidden { display: none !important; }

        /* UI Components */
        .btn-premium { background: var(--apple-dark); color: white; border: none; padding: 16px 30px; border-radius: 15px; font-weight: 600; cursor: pointer; transition: 0.3s; width: 100%; }
        .card { background: white; border-radius: 24px; padding: 20px; box-shadow: var(--shadow); margin-bottom: 20px; }

        /* 1. Header & Hero */
        #hero-page { height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('https://images.unsplash.com/photo-1598515214211-89d3c73ae83b?q=80&w=2070') center/cover; text-align: center; color: white; }
        
        header { position: fixed; top: 0; width: 100%; height: 70px; background: var(--glass); backdrop-filter: blur(20px); display: flex; align-items: center; padding: 0 20px; z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.05); justify-content: space-between; }

        /* 2. Menu Grid */
        #menu-page { padding: 90px 15px 150px; }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .item-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.03); }
        .item-img { width: 100%; height: 140px; object-fit: cover; }
        .item-info { padding: 15px; }
        
        /* 3. Sticky Cart Bar (Option B Logic) */
        .sticky-cart { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 450px; background: var(--apple-dark); color: white; padding: 18px 25px; border-radius: 25px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 20px 50px rgba(0,0,0,0.4); z-index: 2000; cursor: pointer; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .sticky-cart:active { transform: translateX(-50%) scale(0.95); }

        /* 4. Checkout Drawer */
        .drawer-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); z-index: 3000; display: none; }
        .drawer { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-radius: 30px 30px 0 0; padding: 30px 25px; transform: translateY(100%); transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1); z-index: 3001; max-height: 85vh; overflow-y: auto; }
        .drawer.active { transform: translateY(0); }

        /* 5. Admin Panel POS Style */
        #admin-page { padding: 90px 15px 50px; }
        .status-pill { padding: 5px 12px; border-radius: 10px; font-size: 0.75rem; font-weight: 700; }
        .pending { background: #FFF4ED; color: #FF6B00; }
        .confirmed { background: #ECFDF5; color: #10B981; }

        /* Quantity controls */
        .qty-ctrl { display: flex; align-items: center; background: #F2F2F7; border-radius: 12px; padding: 4px; margin-top: 10px; width: fit-content; }
        .qty-btn { border: none; background: white; width: 32px; height: 32px; border-radius: 8px; font-weight: bold; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .qty-val { margin: 0 15px; font-weight: 700; }

        /* Form Inputs */
        input, select { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #E5E5EA; margin-bottom: 15px; font-family: inherit; font-size: 1rem; }
    </style>
</head>
<body>

    <header class="hidden" id="main-header">
        <div onclick="goHome()" style="cursor:pointer;"><i class="fas fa-chevron-left"></i></div>
        <b style="letter-spacing: 1px; font-size: 0.9rem;">MYIN THAR ROASTED</b>
        <div id="shop-status" class="status-pill confirmed">OPEN</div>
    </header>

    <div id="hero-page">
        <div>
            <h1 style="font-size: 3rem; font-weight: 700; margin-bottom: 10px;">MYIN THAR</h1>
            <p style="opacity: 0.8; margin-bottom: 30px;">Premium Taste, Professional Service</p>
            <button class="btn-premium" style="background: white; color: black; width: auto; padding: 18px 50px; border-radius: 50px;" onclick="startOrdering()">·Äô·Äæ·Ä¨·Äö·Ä∞·Äõ·Äî·Ä∫ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Ä´</button>
            <p onclick="loginAdmin()" style="margin-top: 40px; font-size: 0.7rem; opacity: 0.5; cursor: pointer;">ADMIN ACCESS</p>
        </div>
    </div>

    <div id="menu-page" class="hidden">
        <div class="menu-grid" id="menu-container">
            </div>
    </div>

    <div class="sticky-cart hidden" id="sticky-bar" onclick="openDrawer()">
        <div>
            <span id="total-qty">0</span> ·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏ | <span id="total-price">0</span> Ks
        </div>
        <div style="font-weight: 700;">CHECKOUT <i class="fas fa-arrow-right" style="margin-left:8px;"></i></div>
    </div>

    <div class="drawer-overlay" id="overlay" onclick="closeDrawer()"></div>
    <div class="drawer" id="drawer">
        <h2 style="margin-bottom: 20px; font-weight: 700;">·Äû·ÄÑ·Ä∑·Ä∫·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´</h2>
        <div id="cart-details" style="margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 20px;"></div>
        
        <div id="verify-section">
            <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äõ·Äî·Ä∫ Telegram ·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Ä°·Äõ·ÄÑ·Ä∫·ÄÖ·ÄÖ·Ä∫·ÄÜ·Ä±·Ä∏·Äï·Ä±·Ä∏·Äï·Ä´</p>
            <button class="btn-premium" style="background: #0088cc;" onclick="verifyWithBot()">
                <i class="fab fa-telegram-plane" style="margin-right: 10px;"></i> VERIFY TELEGRAM
            </button>
        </div>

        <div id="final-form" class="hidden">
            <input type="text" id="cust-name" placeholder="·Äû·ÄÑ·Ä∑·Ä∫·Ä°·Äô·Ää·Ä∫">
            <select id="order-type">
                <option value="today">·Äö·Äî·Ä±·Ä∑·Äô·Äæ·Ä¨·Äö·Ä∞·Äô·Ää·Ä∫ (Today)</option>
                <option value="preorder">·ÄÄ·Äº·Ä≠·ÄØ·Äê·ÄÑ·Ä∫·Äô·Äæ·Ä¨·Äö·Ä∞·Äô·Ää·Ä∫ (Pre-order)</option>
            </select>
            <input type="time" id="pickup-time" placeholder="·Äú·Ä¨·Äö·Ä∞·Äô·Ää·Ä∑·Ä∫·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫">
            <button class="btn-premium" onclick="placeOrder()">PLACE ORDER NOW</button>
        </div>
    </div>

    <div id="admin-page" class="hidden">
        <h2 style="margin-bottom: 20px;">Live Orders</h2>
        <div id="admin-orders-list"></div>
    </div>

    <audio id="noti-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <script>
        // --- 1. CONFIGURATION ---
        const TG_BOT_TOKEN = '8215695761:AAF1qDjAJn7gjiHyzf8t7W6c8e51cim98sU';
        const TG_CHAT_ID = '8116152317';
        const DB_URL = 'https://deabtvqzxpkepgcdutzd.supabase.co';
        const DB_KEY = 'sb_publishable_1oVmjwUas1mPm6Yk6evKvw_RU3MBvXc'; // Replace with real key if needed
        const _supabase = window.supabase.createClient(DB_URL, DB_KEY);

        const items = [
            { name: "·ÄÄ·Äº·ÄÄ·Ä∫·Äï·Ä±·Ä´·ÄÑ·Ä∫", price: 4000 }, { name: "·ÄÄ·Äº·ÄÄ·Ä∫·Äõ·ÄÑ·Ä∫·Ä°·ÄØ·Ä∂", price: 4000 },
            { name: "·ÄÜ·Ä≠·Äê·Ä∫·Äû·Ä¨·Ä∏·ÄÄ·ÄÑ·Ä∫", price: 1500 }, { name: "·Ä°·Äû·Ä¨·Ä∏ ·ÄÅ·Äª·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏(·ÄÄ·Äº·ÄÄ·Ä∫)", price: 800 },
            { name: "·Ä°·Äõ·Ä±·ÄÅ·ÄΩ·Ä∂", price: 500 }, { name: "·Ä°·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Äï·Äª·Ä∂", price: 500 },
            { name: "·Ä°·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Äï·Äª·Ä∂ (CP)", price: 1000 }, { name: "·Ä°·Ä∞", price: 500 },
            { name: "·ÄÅ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏", price: 300 }, { name: "·Äú·Ää·Ä∫ ·ÄÅ·Äª·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏", price: 300 },
            { name: "·Ä°·Äû·Ää·Ä∫·Ä∏·Äô·Äº·ÄÖ·Ä∫", price: 500 }, { name: "·ÄÅ·Äº·Ä±·Äë·Ä±·Ä¨·ÄÄ·Ä∫", price: 300 },
            { name: "·ÄÅ·Äº·Ä±·Äë·Ä±·Ä¨·ÄÄ·Ä∫(CP)", price: 700 }, { name: "·Äú·ÄÄ·Ä∫·Äô·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äú·ÄØ·Ä∂·Ä∏", price: 1000 },
            { name: "·Ä°·ÄÜ·ÄÆ·Äï·Ä∞·Ä∏", price: 800 }, { name: "·Ä°·Äû·Ä¨·Ä∏·Äê·ÄØ", price: 400 },
            { name: "·Äõ·ÄØ·Ä∂·Ä∏·Äï·Äê·Ä±·Äû·ÄÆ·Ä∏", price: 300 }, { name: "·Ä°·Äï·Ä∫·Äô·Äæ·Ä≠·ÄØ", price: 1000 },
            { name: "·ÄÑ·ÄØ·Ä∂·Ä∏·Ä•", price: 1000 }
        ];

        let cart = {};
        let isVerified = false;

        // --- 2. CUSTOMER FLOW ---
        function startOrdering() {
            document.getElementById('hero-page').classList.add('hidden');
            document.getElementById('menu-page').classList.remove('hidden');
            document.getElementById('main-header').classList.remove('hidden');
            renderMenu();
            restoreCart(); // Part 2 logic: Restore from local storage
        }

        function renderMenu() {
            const container = document.getElementById('menu-container');
            container.innerHTML = items.map((item, idx) => `
                <div class="item-card">
                    <img src="https://via.placeholder.com/200x140?text=${item.name}" class="item-img">
                    <div class="item-info">
                        <b style="font-size:0.85rem;">${item.name}</b>
                        <div style="color:var(--premium-orange); font-weight:700; margin-top:5px;">${item.price} Ks</div>
                        <div class="qty-ctrl">
                            <button class="qty-btn" onclick="changeQty('${item.name}', -1)">-</button>
                            <span class="qty-val" id="qty-${idx}">0</span>
                            <button class="qty-btn" onclick="changeQty('${item.name}', 1)">+</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function changeQty(name, delta) {
            cart[name] = (cart[name] || 0) + delta;
            if (cart[name] <= 0) delete cart[name];
            
            // Sync UI
            const idx = items.findIndex(i => i.name === name);
            if(idx !== -1) document.getElementById(`qty-${idx}`).innerText = cart[name] || 0;
            
            saveCart();
            updateStickyBar();
        }

        function updateStickyBar() {
            const totalQty = Object.values(cart).reduce((a,b) => a+b, 0);
            const totalPrice = Object.keys(cart).reduce((s, n) => s + (items.find(i=>i.name===n).price * cart[n]), 0);
            
            const bar = document.getElementById('sticky-bar');
            if(totalQty > 0) {
                bar.classList.remove('hidden');
                document.getElementById('total-qty').innerText = totalQty;
                document.getElementById('total-price').innerText = totalPrice;
            } else {
                bar.classList.add('hidden');
            }
        }

        function saveCart() { localStorage.setItem('myinthar_cart', JSON.stringify(cart)); }
        function restoreCart() {
            const saved = localStorage.getItem('myinthar_cart');
            if(saved) {
                cart = JSON.parse(saved);
                Object.keys(cart).forEach(name => {
                    const idx = items.findIndex(i => i.name === name);
                    if(idx !== -1) document.getElementById(`qty-${idx}`).innerText = cart[name];
                });
                updateStickyBar();
            }
        }

        // --- 3. CHECKOUT & VERIFY (OPTION B) ---
        function openDrawer() {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('drawer').classList.add('active');
            
            const details = document.getElementById('cart-details');
            details.innerHTML = Object.keys(cart).map(name => `
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span>${name} x ${cart[name]}</span>
                    <b>${items.find(i=>i.name===name).price * cart[name]} Ks</b>
                </div>
            `).join('');
        }

        function closeDrawer() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('drawer').classList.remove('active');
        }

        function verifyWithBot() {
            window.open('https://t.me/myinthar_order_bot', '_blank');
            // Fake verification for demo, real one would check via Supabase
            setTimeout(() => {
                isVerified = true;
                document.getElementById('verify-section').classList.add('hidden');
                document.getElementById('final-form').classList.remove('hidden');
            }, 2000);
        }

        async function placeOrder() {
            const name = document.getElementById('cust-name').value;
            const time = document.getElementById('pickup-time').value;
            const type = document.getElementById('order-type').value;
            if(!name || !time) return alert("·Ä°·Äô·Ää·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫·Äñ·Äº·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´");

            const vn = "MT-" + Date.now().toString().slice(-5);
            const total = document.getElementById('total-price').innerText;
            const itemStr = Object.keys(cart).map(n => `${n}(${cart[n]})`).join(", ");

            // Save to Supabase
            const { error } = await _supabase.from('orders').insert([{
                voucher_no: vn, customer_name: name, items: itemStr, total: total, pickup_time: time, order_type: type, status: 'pending'
            }]);

            if(!error) {
                // Notify Bot
                const msg = `üöÄ *·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Ä°·Äû·ÄÖ·Ä∫ (${type})*\nVoucher: ${vn}\nCustomer: ${name}\nItems: ${itemStr}\nTotal: ${total} Ks\nTime: ${time}`;
                fetch(`https://api.telegram.org/bot${TG_BOT_TOKEN}/sendMessage?chat_id=${TG_CHAT_ID}&text=${encodeURIComponent(msg)}&parse_mode=Markdown`);
                
                alert("·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Äê·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã ·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Äô·Äæ ·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äû·Ää·Ä∫·Ä°·Äë·Ä≠ ·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´·Åã");
                localStorage.removeItem('myinthar_cart');
                location.reload();
            }
        }

        // --- 4. ADMIN POS LOGIC ---
        function loginAdmin() {
            if(prompt("Admin Password:") === "2012@Yewin") {
                document.getElementById('hero-page').classList.add('hidden');
                document.getElementById('main-header').classList.remove('hidden');
                document.getElementById('admin-page').classList.remove('hidden');
                loadAdminOrders();
                
                // Real-time listener for Redmi Noti fix
                _supabase.channel('orders').on('postgres_changes', {event:'INSERT', schema:'public', table:'orders'}, payload => {
                    document.getElementById('noti-sound').play();
                    loadAdminOrders();
                }).subscribe();
            }
        }

        async function loadAdminOrders() {
            const { data } = await _supabase.from('orders').select('*').order('id', {ascending: false});
            const list = document.getElementById('admin-orders-list');
            list.innerHTML = data.map(o => `
                <div class="card" style="border-left: 6px solid ${o.status==='pending'?'#FF6B00':'#10B981'}">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <b>#${o.voucher_no}</b>
                        <span class="status-pill ${o.status==='pending'?'pending':'confirmed'}">${o.status.toUpperCase()}</span>
                    </div>
                    <div style="font-size:0.9rem; margin-bottom:10px;">${o.items}</div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <small>${o.customer_name} | ${o.pickup_time}</small>
                        ${o.status === 'pending' ? `<button class="btn-premium" style="width:auto; padding:8px 15px; font-size:0.8rem;" onclick="updateStatus(${o.id}, 'done')">Done</button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        async function updateStatus(id, status) {
            await _supabase.from('orders').update({status: status}).eq('id', id);
            loadAdminOrders();
        }
    </script>
</body>
</html>

