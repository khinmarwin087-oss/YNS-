<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçó MYIN THAR - CRYPTO STYLE POS</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Binance Crypto Theme Colors */
        :root {
            --bg-dark: #0b0e11;
            --bg-card: #1e2329;
            --primary: #fcd535; /* Binance Yellow */
            --text-main: #eaecef;
            --text-dim: #848e9c;
            --success: #0ecb81;
            --danger: #f6465d;
            --border: #333941;
        }

        body {
            font-family: 'Inter', 'Pyidaungsu', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding-bottom: 80px;
        }

        .hidden { display: none !important; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

        /* Header Styles */
        header {
            padding: 20px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            color: var(--primary);
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(14, 203, 129, 0.15);
            color: var(--success);
        }

        /* Container */
        .container { padding: 15px; max-width: 600px; margin: auto; }

        /* Crypto Card Style */
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 15px;
            border: 1px solid transparent;
            transition: 0.3s;
        }
        .card:hover { border-color: var(--border); }

        /* Menu Grid */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

        .item-card {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .item-img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            opacity: 0.9;
        }

        .item-info { padding: 12px; }
        .item-name { font-size: 14px; font-weight: 500; margin-bottom: 5px; }
        .item-price { color: var(--primary); font-size: 16px; font-weight: bold; }

        /* Quantity Controls */
        .qty-box {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 12px;
            background: var(--bg-dark);
            border-radius: 6px;
            padding: 4px;
        }

        .btn-qty {
            background: #2b3139;
            color: var(--text-main);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-qty:hover { background: var(--border); }

        /* Bottom Navigation (Crypto App Style) */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 600px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            display: flex;
            padding: 10px 0;
            border-top: 1px solid var(--border);
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            color: var(--text-dim);
            font-size: 11px;
            cursor: pointer;
        }

        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 20px; margin-bottom: 4px; display: block; }

        /* Floating Cart Bar (Trading Bar Style) */
        #cart-bar {
            position: fixed;
            bottom: 85px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 30px);
            max-width: 570px;
            background: var(--primary);
            color: var(--bg-dark);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            z-index: 999;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        /* Sidebar for Admin (Crypto Menu) */
        #sidebar {
            position: fixed;
            left: 0; top: 0; bottom: 0;
            width: 260px;
            background: var(--bg-card);
            z-index: 2000;
            padding: 25px;
            transform: translateX(-100%);
            transition: 0.3s;
            border-right: 1px solid var(--border);
        }
        #sidebar.active { transform: translateX(0); }

        /* Inputs & Buttons */
        input {
            width: 100%;
            padding: 14px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-main);
            margin-bottom: 12px;
            box-sizing: border-box;
        }
        input:focus { border-color: var(--primary); outline: none; }

        .btn-main {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: var(--bg-dark);
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
        }

        /* Tables for Admin */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { color: var(--text-dim); font-size: 12px; text-align: left; padding: 10px; border-bottom: 1px solid var(--border); }
        td { padding: 12px 10px; border-bottom: 1px solid var(--border); font-size: 13px; }

        .badge-pending { color: var(--primary); background: rgba(252, 213, 53, 0.1); padding: 4px 8px; border-radius: 4px; }
        
        /* Drawer */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1500; display: none; }
        .drawer {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            border-radius: 20px 20px 0 0;
            padding: 25px;
            z-index: 1600;
            max-height: 85vh;
            overflow-y: auto;
            display: none;
        }
    </style>
</head>
<body>

<header>
    <div class="logo">
        <i class="fas fa-coins"></i>
        <span>MYIN THAR</span>
    </div>
    <div id="shop-status" class="status-badge">Market Open</div>
</header>

<div id="v-home" class="view container">
    <div style="margin-bottom: 20px;">
        <h4 style="margin: 0; color: var(--text-dim);">Hot Deals</h4>
        <div id="menu-list" class="grid" style="margin-top:15px;"></div>
    </div>
</div>

<div id="v-profile" class="view container hidden">
    <h3 style="color: var(--primary);"><i class="fas fa-history"></i> My History</h3>
    <div id="user-info" class="card" style="border-left: 4px solid var(--primary);"></div>
    <div id="history-list"></div>
</div>

<div id="v-admin" class="view container hidden">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3>Dashboard</h3>
        <button onclick="toggleSidebar(true)" style="background:none; border:none; color:var(--text-main); font-size:20px;"><i class="fas fa-bars"></i></button>
    </div>
    
    <div id="admin-orders"></div>
    <div id="admin-inventory" class="hidden"></div>
</div>

<div id="v-voucher" class="view container hidden" style="text-align: center;">
    <div class="card" style="border: 2px solid var(--primary);">
        <h2 style="color: var(--success); margin-bottom: 5px;">TRADE SUCCESS</h2>
        <svg id="barcode"></svg>
        <div id="vd" style="text-align: left; margin-top: 20px; border-top: 1px dashed var(--border); padding-top: 15px; font-family: monospace;"></div>
        <button onclick="sendViber()" class="btn-main" style="background:#7360f2; color:white; margin-top:20px;">
            <i class="fab fa-viber"></i> SEND VIA VIBER
        </button>
    </div>
</div>

<div id="sidebar">
    <h3 style="color:var(--primary);">Control Panel</h3>
    <hr style="border:0; border-top:1px solid var(--border); margin: 20px 0;">
    <div style="display:flex; flex-direction:column; gap:10px;">
        <div class="nav-item" onclick="setAdminTab('orders')" style="text-align:left; font-size:16px; color:white; padding:10px;"><i class="fas fa-list"></i> Orders</div>
        <div class="nav-item" onclick="setAdminTab('inventory')" style="text-align:left; font-size:16px; color:white; padding:10px;"><i class="fas fa-box"></i> Stock Edit</div>
        <div class="nav-item" onclick="toggleShop()" style="text-align:left; font-size:16px; color:white; padding:10px;"><i class="fas fa-power-off"></i> Shop Open/Close</div>
    </div>
    <button onclick="toggleSidebar(false)" style="margin-top: 50px; background:none; border:1px solid var(--border); color:var(--text-dim); padding:10px; width:100%; border-radius:8px;">Back</button>
</div>

<div id="cart-bar" class="hidden" onclick="toggleDrawer(true)">
    <span><i class="fas fa-shopping-cart"></i> <span id="cart-qty">0</span> Assets Selected</span>
    <span>Review ></span>
</div>

<div id="overlay" class="overlay" onclick="toggleDrawer(false)"></div>
<div id="drawer" class="drawer">
    <h3 style="margin-top:0;"><i class="fas fa-wallet" style="color:var(--primary);"></i> Checkout</h3>
    <div id="cart-summary" style="margin-bottom:20px;"></div>
    
    <input type="text" id="c-name" placeholder="Enter Your Name">
    <input type="number" id="c-phone" placeholder="Phone Number">
    <input type="time" id="c-time" value="12:00">
    
    <div style="display:flex; justify-content:space-between; margin: 20px 0; font-size:20px; font-weight:bold;">
        <span>Grand Total:</span>
        <span id="c-total" style="color:var(--primary);">0 K</span>
    </div>
    
    <button onclick="confirmOrder()" class="btn-main">CONFIRM ORDER</button>
</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="showPage('home')"><i class="fas fa-layer-group"></i>Market</div>
    <div class="nav-item" onclick="showPage('profile')"><i class="fas fa-chart-pie"></i>Portfolio</div>
    <div class="nav-item" onclick="handleAdmin()"><i class="fas fa-shield-alt"></i>Account</div>
</nav>

<script>
    const SB_URL = "https://deabtvqzxpkepgcdutzd.supabase.co";
    const SB_KEY = "sb_publishable_1oVmjwUas1mPm6Yk6evKvw_RU3MBvXc";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

    let menu = [], cart = [], activeOrder = null, isShopOpen = true;

    async function init() {
        const { data: m } = await _supabase.from('menu_items').select('*').order('name');
        const { data: s } = await _supabase.from('shop_settings').select('*').eq('id', 1).single();
        menu = m; isShopOpen = s.is_open;
        renderMenu(); updateShopUI();
        
        _supabase.channel('orders').on('postgres_changes', {event:'INSERT', schema:'public', table:'orders'}, () => {
            new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3').play();
            if(!document.getElementById('v-admin').classList.contains('hidden')) loadAdmin();
        }).subscribe();
    }

    function renderMenu() {
        document.getElementById('menu-list').innerHTML = menu.map(i => {
            const inCart = cart.find(c => c.id === i.id) || {qty:0};
            return `
                <div class="item-card">
                    <img src="${i.photo_url}" class="item-img">
                    <div class="item-info">
                        <div class="item-name">${i.name}</div>
                        <div class="item-price">${i.price} K</div>
                        <div class="qty-box">
                            <button class="btn-qty" onclick="changeQty(${i.id}, -1)">-</button>
                            <span style="font-weight:bold;">${inCart.qty}</span>
                            <button class="btn-qty" onclick="changeQty(${i.id}, 1)" style="color:var(--primary);">+</button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function changeQty(id, delta) {
        const item = menu.find(m => m.id === id);
        const cartItem = cart.find(c => c.id === id);
        if(cartItem) {
            cartItem.qty += delta;
            if(cartItem.qty <= 0) cart = cart.filter(c => c.id !== id);
        } else if(delta > 0) {
            cart.push({...item, qty: 1});
        }
        renderMenu(); updateCartBar();
    }

    function updateCartBar() {
        const q = cart.reduce((a, b) => a + b.qty, 0);
        document.getElementById('cart-bar').classList.toggle('hidden', q === 0);
        document.getElementById('cart-qty').innerText = q;
        document.getElementById('c-total').innerText = cart.reduce((a, b) => a + (b.price * b.qty), 0) + " K";
        document.getElementById('cart-summary').innerHTML = cart.map(c => `
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span>${c.name} x ${c.qty}</span>
                <b>${c.price * c.qty} K</b>
            </div>
        `).join('');
    }

    async function confirmOrder() {
        const name = document.getElementById('c-name').value;
        const phone = document.getElementById('c-phone').value;
        const time = document.getElementById('c-time').value;
        if(!name || !phone) return alert("Please fill all details!");
        
        const vn = "YNS-" + Date.now().toString().slice(-6);
        const total = cart.reduce((a, b) => a + (b.price * b.qty), 0);
        const items = cart.map(c => `${c.name}(${c.qty})`).join(', ');

        const { data, error } = await _supabase.from('orders').insert([{
            voucher_no: vn, customer_name: name, phone: phone, items: items, total: total, pickup_time: time
        }]).select();

        if(!error) {
            localStorage.setItem('u_name', name); localStorage.setItem('u_phone', phone);
            activeOrder = data[0];
            showVoucher(data[0]);
            cart = []; updateCartBar(); renderMenu(); toggleDrawer(false);
        }
    }

    function showVoucher(o) {
        showPage('voucher');
        JsBarcode("#barcode", o.voucher_no, {lineColor: "#fcd535", background: "transparent", width: 2, height: 50, displayValue: false});
        document.getElementById('vd').innerHTML = `
            ORDER_ID: ${o.voucher_no}<br>
            STATUS: CONFIRMED<br>
            ASSETS: ${o.items}<br>
            VALUE: ${o.total} K<br>
            PICKUP: ${o.pickup_time}
        `;
    }

    function sendViber() {
        const msg = `üßæ *MYIN THAR ORDER*\nID: ${activeOrder.voucher_no}\nUser: ${activeOrder.customer_name}\nAssets: ${activeOrder.items}\nValue: ${activeOrder.total} K\nTime: ${activeOrder.pickup_time}`;
        window.location.href = `viber://chat?number=%2B959793139886&draft=${encodeURIComponent(msg)}`;
    }

    async function loadAdmin() {
        const { data: ords } = await _supabase.from('orders').select('*').order('id', {ascending: false});
        document.getElementById('admin-orders').innerHTML = ords.map(o => `
            <div class="card">
                <div style="display:flex; justify-content:space-between;">
                    <b style="color:var(--primary);">#${o.voucher_no}</b>
                    <span class="badge-pending">${o.pickup_time}</span>
                </div>
                <div style="margin: 10px 0; font-size: 13px;">${o.items}</div>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <small>${o.customer_name}</small>
                    <a href="tel:${o.phone}" style="color:var(--success);"><i class="fas fa-phone"></i> Call</a>
                </div>
            </div>
        `).join('');
        
        const { data: items } = await _supabase.from('menu_items').select('*').order('name');
        document.getElementById('admin-inventory').innerHTML = `
            <table>
                <thead><tr><th>Asset</th><th>Price</th><th>Stock</th></tr></thead>
                <tbody>
                    ${items.map(i => `
                        <tr>
                            <td>${i.name}</td>
                            <td onclick="editItem(${i.id},'price',${i.price})"><u>${i.price}</u></td>
                            <td onclick="editItem(${i.id},'stock',${i.stock})"><b style="color:var(--primary)">${i.stock}</b></td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
    }

    async function editItem(id, field, cur) {
        const val = prompt(`New ${field}?`, cur);
        if(val) {
            await _supabase.from('menu_items').update({[field]: parseInt(val)}).eq('id', id);
            loadAdmin();
        }
    }

    function showPage(p) {
        document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
        document.getElementById('v-' + p).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        event.currentTarget.classList.add('active');
        if(p === 'profile') loadHistory();
    }

    async function loadHistory() {
        const ph = localStorage.getItem('u_phone');
        document.getElementById('user-info').innerText = (localStorage.getItem('u_name') || "No Data") + " (" + (ph || "-") + ")";
        if(ph) {
            const { data } = await _supabase.from('orders').select('*').eq('phone', ph).order('id', {ascending: false});
            document.getElementById('history-list').innerHTML = data.map(o => `
                <div class="card"><b>#${o.voucher_no}</b><br><small>${o.items}</small><br><b>${o.total} K</b></div>
            `).join('');
        }
    }

    function handleAdmin() { if(prompt("Pass?") === "2012@Yewin") showPage('admin'); }
    function setAdminTab(t) {
        document.getElementById('admin-orders').classList.toggle('hidden', t !== 'orders');
        document.getElementById('admin-inventory').classList.toggle('hidden', t !== 'inventory');
        toggleSidebar(false);
    }
    function toggleSidebar(s) { document.getElementById('sidebar').classList.toggle('active', s); }
    function toggleDrawer(s) { 
        document.getElementById('drawer').style.display = s ? 'block' : 'none'; 
        document.getElementById('overlay').style.display = s ? 'block' : 'none'; 
    }
    async function toggleShop() {
        isShopOpen = !isShopOpen;
        await _supabase.from('shop_settings').update({is_open: isShopOpen}).eq('id', 1);
        updateShopUI();
    }
    function updateShopUI() {
        document.getElementById('shop-status').innerText = isShopOpen ? "Market Open" : "Market Closed";
        document.getElementById('shop-status').style.color = isShopOpen ? "var(--success)" : "var(--danger)";
    }

    window.onload = init;
</script>
</body>
</html>

