<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ— á€™á€¼á€„á€ºá€á€¬á€€á€¼á€€á€ºá€€á€„á€º - Premium POS</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #e67e22; --secondary: #d35400; --bg: #f8fafc; --dark: #1e293b; }
        body { font-family: 'Pyidaungsu', sans-serif; background: var(--bg); margin: 0; padding: 0; color: var(--dark); }
        
        .header { background: linear-gradient(135deg, #fbbf24, #d35400); color: white; padding: 30px 20px; text-align: center; border-radius: 0 0 30px 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header h2 { margin: 0; font-size: 24px; }
        
        .container { max-width: 600px; margin: auto; padding: 15px; }

        /* Menu Grid Style (2 Columns) */
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 10px; }
        .menu-card { background: white; border-radius: 15px; padding: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #f1f5f9; display: flex; flex-direction: column; justify-content: space-between; position: relative; }
        .menu-card.sold-out { opacity: 0.5; filter: grayscale(1); pointer-events: none; }
        .item-name { font-weight: 700; font-size: 15px; margin-bottom: 5px; color: #334155; }
        .item-price { color: var(--secondary); font-weight: bold; font-size: 14px; margin-bottom: 10px; }
        
        /* Qty Buttons inside Card */
        .qty-box { display: flex; align-items: center; justify-content: space-between; background: #f1f5f9; border-radius: 10px; padding: 4px; }
        .btn-qty { width: 30px; height: 30px; border: none; background: white; border-radius: 8px; cursor: pointer; font-weight: bold; color: var(--secondary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .qty-num { font-weight: bold; font-size: 14px; }

        /* Floating Checkout Bar */
        .footer-bar { position: fixed; bottom: 0; width: 100%; max-width: 600px; background: white; padding: 15px 20px; box-sizing: border-box; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); border-radius: 20px 20px 0 0; display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        .total-text { font-size: 14px; color: #64748b; }
        .total-amount { font-size: 20px; font-weight: bold; color: var(--dark); display: block; }
        .btn-checkout { background: var(--secondary); color: white; border: none; padding: 12px 25px; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; }

        /* Modal (Checkout Overlay) */
        #checkout-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 90%; max-width: 400px; padding: 25px; border-radius: 25px; position: relative; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 13px; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 10px; box-sizing: border-box; font-family: 'Pyidaungsu'; }
        
        .app-choice { display: flex; gap: 10px; margin-top: 20px; }
        .btn-app { flex: 1; padding: 12px; border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .viber-bg { background: #7360f2; }
        .tele-bg { background: #0088cc; }
        
        .notice { background: #fffbeb; border: 1px solid #fef3c7; color: #92400e; padding: 10px; border-radius: 10px; font-size: 12px; margin-top: 15px; text-align: center; }
    </style>
</head>
<body>

<div class="header">
    <h2>ğŸ— á€™á€¼á€„á€ºá€á€¬á€€á€¼á€€á€ºá€€á€„á€º</h2>
    <p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.9;">á€¡á€›á€á€¬á€€á€±á€¬á€„á€ºá€¸á€™á€½á€”á€ºá€á€±á€¬ á€€á€¼á€€á€ºá€€á€„á€ºá€”á€¾á€„á€·á€º á€¡á€€á€„á€ºá€…á€¯á€¶</p>
</div>

<div class="container" style="margin-bottom: 100px;">
    <h3 style="font-size: 17px; margin-left: 5px;">ğŸ”¥ á€™á€®á€”á€°á€¸á€™á€»á€¬á€¸</h3>
    <div id="menu-grid" class="menu-grid">
        </div>
</div>

<div class="footer-bar">
    <div>
        <span class="total-text">á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ á€€á€»á€á€„á€·á€ºá€„á€½á€±</span>
        <span class="total-amount"><span id="total-price">0</span> K</span>
    </div>
    <button class="btn-checkout" onclick="openCheckout()">Check Out â”</button>
</div>

<div id="checkout-modal">
    <div class="modal-content">
        <h3 style="margin-top:0;">ğŸ“‹ á€¡á€±á€¬á€ºá€’á€«á€¡á€á€Šá€ºá€•á€¼á€¯á€›á€”á€º</h3>
        <div class="input-group">
            <label>ğŸ‘¤ á€á€šá€ºá€á€°á€¡á€™á€Šá€º</label>
            <input type="text" id="cust-name" placeholder="á€¡á€™á€Šá€ºá€–á€¼á€Šá€·á€ºá€•á€«">
        </div>
        <div class="input-group">
            <label>ğŸ“ á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º</label>
            <input type="tel" id="cust-phone" placeholder="á€á‰xxxxxxxxx">
        </div>
        <div class="input-group">
            <label>ğŸ“… á€œá€¬á€šá€°á€™á€Šá€·á€ºá€¡á€á€»á€­á€”á€º</label>
            <input type="datetime-local" id="pickup-datetime">
        </div>

        <p style="font-size: 13px; font-weight: bold; margin-bottom: 10px;">á€˜á€šá€º App á€€á€”á€± á€•á€­á€¯á€·á€™á€œá€²?</p>
        <div class="app-choice">
            <button class="btn-app viber-bg" onclick="submitOrder('viber')">Viber ğŸŸ£</button>
            <button class="btn-app tele-bg" onclick="submitOrder('telegram')">Telegram ğŸ”µ</button>
        </div>

        <div class="notice">
            âš ï¸ á€¡á€±á€¬á€ºá€’á€«á€á€„á€ºá€•á€¼á€®á€¸á€•á€«á€€ á€†á€­á€¯á€„á€ºá€›á€¾á€„á€ºá€¡á€¬á€¸ á€–á€¯á€”á€ºá€¸á€–á€¼á€„á€·á€º <br>
            <b>á€á‰-á‡á†á‡ á‚áˆá‡ áƒá„á…</b> á€á€­á€¯á€· á€†á€€á€ºá€á€½á€šá€ºá€•á€±á€¸á€•á€«á‹
        </div>
        <button onclick="closeCheckout()" style="width:100%; border:none; background:none; color:#94a3b8; margin-top:15px; font-size:13px;">á€™á€™á€¾á€¬á€á€±á€¸á€•á€« (á€•á€¼á€”á€ºá€‘á€½á€€á€ºá€™á€Šá€º)</button>
    </div>
</div>

<script>
    const SB_URL = "https://deabtvqzxpkepgcdutzd.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlYWJ0dnF6eHBrZXBnY2R1dHpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNzQzNDMsImV4cCI6MjA4MTg1MDM0M30.BbxmM65uoTDcf_nTP6w5siSF6Y5_eM4peqYJCAxR90I";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);
    const MY_PHONE = "959767287345";
    const VIBER_BUSINESS_URI = "d42829d6-dced-11f0-a2db-36dcc9215546";

    let cart = {};
    let menuData = [];

    async function fetchMenu() {
        const { data } = await _supabase.from('menu_items').select('*').order('name');
        if (data) { menuData = data; renderMenu(); }
    }

    function renderMenu() {
        const grid = document.getElementById('menu-grid');
        grid.innerHTML = menuData.map(item => `
            <div class="menu-card ${item.stock_qty <= 0 ? 'sold-out' : ''}">
                <div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">${item.price.toLocaleString()} K</div>
                </div>
                <div class="qty-box">
                    <button class="btn-qty" onclick="updateQty('${item.name}', -1)">-</button>
                    <span class="qty-num" id="qty-${item.name}">0</span>
                    <button class="btn-qty" onclick="updateQty('${item.name}', 1)">+</button>
                </div>
            </div>
        `).join('');
    }

    function updateQty(name, change) {
        const item = menuData.find(i => i.name === name);
        cart[name] = (cart[name] || 0) + change;
        if (cart[name] < 0) cart[name] = 0;
        if (cart[name] > item.stock_qty) cart[name] = item.stock_qty;
        document.getElementById(`qty-${name}`).innerText = cart[name];
        
        let total = 0;
        menuData.forEach(i => total += (cart[i.name] || 0) * i.price);
        document.getElementById('total-price').innerText = total.toLocaleString();
    }

    function openCheckout() {
        if (document.getElementById('total-price').innerText === "0") return alert("á€¡á€›á€„á€ºá€¦á€¸á€…á€½á€¬ á€•á€…á€¹á€…á€Šá€ºá€¸á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€±á€¸á€•á€«á‹");
        document.getElementById('checkout-modal').style.display = 'flex';
    }

    function closeCheckout() {
        document.getElementById('checkout-modal').style.display = 'none';
    }

    async function submitOrder(sendVia) {
        const name = document.getElementById('cust-name').value;
        const phone = document.getElementById('cust-phone').value;
        const pickup = document.getElementById('pickup-datetime').value;

        if (!name || !phone || !pickup) return alert("á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€•á€¼á€Šá€·á€ºá€…á€¯á€¶á€…á€½á€¬ á€–á€¼á€Šá€·á€ºá€…á€½á€€á€ºá€•á€±á€¸á€•á€«á‹");

        let itemsArr = [];
        for (let k in cart) {
            if (cart[k] > 0) {
                itemsArr.push(`${k} [${cart[k]} á€á€¯]`);
                const item = menuData.find(i => i.name === k);
                await _supabase.from('menu_items').update({ stock_qty: item.stock_qty - cart[k] }).eq('id', item.id);
            }
        }

        const { data } = await _supabase.from('orders').insert([{
            customer_name: name, phone: phone, items: itemsArr.join(", "), total: document.getElementById('total-price').innerText, pickup_time: pickup
        }]).select();

        const pickupTime = new Date(pickup).toLocaleString('my-MM', { dateStyle: 'medium', timeStyle: 'short' });
        const msg = `ğŸ— *á€™á€¼á€„á€ºá€á€¬á€€á€¼á€€á€ºá€€á€„á€º (á€¡á€±á€¬á€ºá€’á€« #${data[0].id})*\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ‘¤ *á€á€šá€ºá€á€°:* ${name}\nğŸ“ *á€–á€¯á€”á€ºá€¸:* ${phone}\nğŸ“… *á€œá€¬á€šá€°á€™á€Šá€º:* ${pickupTime}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“¦ *á€™á€¾á€¬á€šá€°á€á€Šá€·á€ºá€…á€¬á€›á€„á€ºá€¸:*\n${itemsArr.map(i => "â–ªï¸ " + i).join('\n')}\n\nğŸ’° *á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸:* *${document.getElementById('total-price').innerText} MMK*\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâš ï¸ á€¡á€±á€¬á€ºá€’á€«á€á€„á€ºá€•á€¼á€®á€¸á€•á€«á€€ á€†á€­á€¯á€„á€ºá€›á€¾á€„á€ºá€–á€¯á€”á€ºá€¸ á€á‰á‡á†á‡á‚áˆá‡áƒá„á… á€á€­á€¯á€· á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€€á€¼á€¬á€¸á€•á€±á€¸á€•á€«á‹`;

        if (sendVia === 'viber') {
            window.location.href = `viber://pa?chatURI=${VIBER_BUSINESS_URI}&text=${encodeURIComponent(msg)}`;
        } else {
            window.location.href = `https://t.me/+${MY_PHONE}?text=${encodeURIComponent(msg)}`;
        }
    }

    window.onload = fetchMenu;
</script>
</body>
</html>

